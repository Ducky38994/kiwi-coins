<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçê Kiwi Coins</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #0f0f0f, #1a1a1a);
      color: #e0e0e0;
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .wrap {
      max-width: 800px;
      margin: auto;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid #4CAF50;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    h1 {
      text-align: center;
      color: #4CAF50;
      font-size: 2.5em;
      margin-bottom: 20px;
      text-shadow: 0 0 10px #4CAF50;
    }
    .balance {
      background: linear-gradient(90deg, #2e2e2e, #1e1e1e);
      border: 2px solid #4CAF50;
      padding: 15px;
      text-align: center;
      font-weight: bold;
      font-size: 1.5em;
      margin-bottom: 30px;
      border-radius: 10px;
      color: #4CAF50;
    }
    .nav {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    .nav button {
      background: #2e2e2e;
      color: #e0e0e0;
      border: 1px solid #555;
      padding: 10px 15px;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    .nav button.active {
      background: #4CAF50;
      color: #fff;
    }
    .nav button:hover {
      background: #4CAF50;
      color: #fff;
    }
    .section {
      display: none;
      margin-bottom: 40px;
      padding: 20px;
      border: 1px solid #555;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.05);
    }
    .section.active {
      display: block;
    }
    .section h3 {
      color: #4CAF50;
      margin-bottom: 15px;
      font-size: 1.3em;
    }
    button {
      background: linear-gradient(90deg, #4CAF50, #66BB6A);
      color: #fff;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      margin: 5px;
      border-radius: 5px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    button:hover {
      background: linear-gradient(90deg, #66BB6A, #4CAF50);
      transform: scale(1.05);
    }
    input {
      background: #2e2e2e;
      color: #e0e0e0;
      border: 1px solid #555;
      padding: 10px;
      margin: 5px 0;
      width: calc(100% - 22px);
      border-radius: 5px;
    }
    .stonk {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
    }
    .transaction {
      padding: 10px;
      margin-bottom: 5px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
      font-size: 0.9em;
    }
    .loan-info {
      margin-top: 10px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üçê Kiwi Coins</h1>
    <div class="balance" id="balance">0 Kiwi</div>

    <!-- Navigation -->
    <div class="nav">
      <button id="nav-mining" class="active">‚õèÔ∏è Mining</button>
      <button id="nav-stonks">üìà Stonks</button>
      <button id="nav-transfer">üí∏ Transfer & Redeem</button>
      <button id="nav-loan">üè¶ Loan</button>
      <button id="nav-transactions">üìú Transactions</button>
    </div>

    <!-- Mining Area -->
    <div id="section-mining" class="section active">
      <h3>‚õèÔ∏è Mining Area</h3>
      <p>Earn 10 Kiwi for every full hour of uptime. Mine to claim your rewards!</p>
      <button onclick="mine()">Mine Kiwi</button>
      <div id="mining-result"></div>
    </div>

    <!-- Stonks Market -->
    <div id="section-stonks" class="section">
      <h3>üìà Stonks Market</h3>
      <p>Invest in volatile assets. Prices fluctuate every 30 seconds!</p>
      <div id="stonks"></div>
    </div>

    <!-- Transfer and Redeem -->
    <div id="section-transfer" class="section">
      <h3>üí∏ Transfer and Redeem</h3>
      <div>
        <h4>Transfer Kiwi</h4>
        <input type="number" id="transfer-amount" placeholder="Amount to Transfer" />
        <button onclick="transferKiwi()">Generate Transfer Code</button>
        <div id="transfer-result"></div>
      </div>
      <div style="margin-top: 20px;">
        <h4>Redeem Kiwi</h4>
        <input type="text" id="redeem-code" placeholder="Enter Redeem Code" />
        <button onclick="redeemKiwi()">Redeem</button>
        <div id="redeem-result"></div>
      </div>
    </div>

    <!-- Loan -->
    <div id="section-loan" class="section">
      <h3>üè¶ Loan</h3>
      <p>Borrow Kiwi with 10% interest per hour. Repay to avoid penalties.</p>
      <input type="number" id="loan-amount" placeholder="Amount to Borrow" />
      <button onclick="takeLoan()">Take Loan</button>
      <button onclick="repayLoan()">Repay Loan</button>
      <div id="loan-result"></div>
      <div class="loan-info" id="loan-info">No active loan.</div>
    </div>

    <!-- Transactions History -->
    <div id="section-transactions" class="section">
      <h3>üìú Transactions History</h3>
      <div id="transactions"></div>
    </div>
  </div>

  <script>
    // -----------------------------
    // Navigation
    // -----------------------------
    const navButtons = document.querySelectorAll('.nav button');
    const sections = document.querySelectorAll('.section');

    navButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons and sections
        navButtons.forEach(btn => btn.classList.remove('active'));
        sections.forEach(sec => sec.classList.remove('active'));

        // Add active class to clicked button and corresponding section
        button.classList.add('active');
        const sectionId = button.id.replace('nav-', 'section-');
        document.getElementById(sectionId).classList.add('active');
      });
    });

    // -----------------------------
    // Persistent Data
    // -----------------------------
    let balance = parseFloat(localStorage.getItem('kiwi_balance')) || 2000;
    let lastMine = parseFloat(localStorage.getItem('kiwi_lastMine')) || Date.now();
    const stonks = JSON.parse(localStorage.getItem('kiwi_stonks')) || {
      wheat: { price: 100, owned: 0 },
      pokemon: { price: 250, owned: 0 },
      gems: { price: 400, owned: 0 },
      banana: { price: 75, owned: 0 },
      techChip: { price: 600, owned: 0 },
      silver: { price: 500, owned: 0 },
      iron: { price: 300, owned: 0 },
      kiwiJuice: { price: 120, owned: 0 }
    };
    const redeemedCodes = JSON.parse(localStorage.getItem('kiwi_redeemed')) || [];
    const transactions = JSON.parse(localStorage.getItem('kiwi_transactions')) || [];
    let loan = JSON.parse(localStorage.getItem('kiwi_loan')) || { amount: 0, timestamp: 0 };

    // -----------------------------
    // Save & Update
    // -----------------------------
    function saveData() {
      localStorage.setItem('kiwi_balance', balance);
      localStorage.setItem('kiwi_lastMine', lastMine);
      localStorage.setItem('kiwi_stonks', JSON.stringify(stonks));
      localStorage.setItem('kiwi_redeemed', JSON.stringify(redeemedCodes));
      localStorage.setItem('kiwi_transactions', JSON.stringify(transactions));
      localStorage.setItem('kiwi_loan', JSON.stringify(loan));
    }

    function updateBalance() {
      document.getElementById('balance').textContent = `${balance.toFixed(2)} Kiwi`;
      saveData();
    }

    function addTransaction(desc) {
      transactions.unshift(`${new Date().toLocaleString()}: ${desc}`);
      if (transactions.length > 50) transactions.pop(); // Keep last 50
      renderTransactions();
      saveData();
    }

    // -----------------------------
    // Mining
    // -----------------------------
    function mine() {
      const now = Date.now();
      const hoursPassed = Math.floor((now - lastMine) / (1000 * 60 * 60));
      if (hoursPassed >= 1) {
        const reward = hoursPassed * 10;
        balance += reward;
        lastMine = now;
        document.getElementById('mining-result').textContent = `‚õèÔ∏è You mined ${reward} Kiwi (${hoursPassed}h uptime).`;
        addTransaction(`Mined ${reward} Kiwi`);
        updateBalance();
      } else {
        document.getElementById('mining-result').textContent = "‚è≥ You need at least 1 hour of uptime before mining again.";
      }
    }

    // -----------------------------
    // Transfer & Redeem System
    // -----------------------------
    function generateCode() {
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let code = "";
      for (let i = 0; i < 8; i++) code += chars.charAt(Math.floor(Math.random() * chars.length));
      return code;
    }

    function transferKiwi() {
      const amt = parseFloat(document.getElementById('transfer-amount').value);
      if (isNaN(amt) || amt <= 0 || amt > balance) {
        document.getElementById('transfer-result').textContent = "‚ùå Invalid amount.";
        return;
      }

      const encodedAmt = btoa(amt.toString());
      const randomCode = generateCode();
      const code = encodedAmt + randomCode;
      balance -= amt;

      updateBalance();

      document.getElementById('transfer-result').innerHTML = `
        ‚úÖ Transfer Code Generated:<br><b>${code}</b><br>
        Share this code with someone to redeem ${amt} Kiwi.
      `;
      addTransaction(`Transferred ${amt} Kiwi (Code: ${code})`);
    }

    function redeemKiwi() {
      const code = document.getElementById('redeem-code').value.trim();
      if (code.length < 8) {
        document.getElementById('redeem-result').textContent = "‚ùå Invalid code.";
        return;
      }
      const randomPart = code.slice(-8);
      const encodedPart = code.slice(0, -8);
      try {
        const amt = parseFloat(atob(encodedPart));
        if (isNaN(amt) || amt <= 0) throw new Error("Invalid amount");
        if (redeemedCodes.includes(code)) {
          document.getElementById('redeem-result').textContent = "‚ö†Ô∏è Code already redeemed!";
          return;
        }
        balance += amt;
        redeemedCodes.push(code);
        document.getElementById('redeem-result').textContent = `üéâ Redeemed ${amt} Kiwi successfully!`;
        addTransaction(`Redeemed ${amt} Kiwi`);
        updateBalance();
      } catch (e) {
        document.getElementById('redeem-result').textContent = "‚ùå Invalid code.";
      }
    }

    // -----------------------------
    // Stonks Market
    // -----------------------------
    function randomFluctuate(price) {
      const change = (Math.random() * 0.1 - 0.05);
      return Math.max(10, price + price * change);
    }

    function updateStonksPrices() {
      for (let key in stonks) {
        stonks[key].price = parseFloat(randomFluctuate(stonks[key].price).toFixed(2));
      }
      renderStonks();
      saveData();
    }

    function buyStonk(name) {
      const s = stonks[name];
      if (balance >= s.price) {
        balance -= s.price;
        s.owned++;
        addTransaction(`Bought 1 ${name} for ${s.price} Kiwi`);
        updateBalance();
        renderStonks();
      } else {
        alert("Not enough Kiwi to buy " + name + "!");
      }
    }

    function sellStonk(name) {
      const s = stonks[name];
      if (s.owned > 0) {
        balance += s.price;
        s.owned--;
        addTransaction(`Sold 1 ${name} for ${s.price} Kiwi`);
        updateBalance();
        renderStonks();
      } else {
        alert("You don't own any " + name + " to sell!");
      }
    }

    function renderStonks() {
      const div = document.getElementById('stonks');
      div.innerHTML = "";
      for (let name in stonks) {
        const s = stonks[name];
        div.innerHTML += `
          <div class="stonk">
            <span>${name} ‚Äî ${s.price.toFixed(2)} Kiwi (Owned: ${s.owned})</span>
            <div>
              <button onclick="buyStonk('${name}')">Buy</button>
              <button onclick="sellStonk('${name}')">Sell</button>
            </div>
          </div>
        `;
      }
    }

    // -----------------------------
    // Loan System
    // -----------------------------
    function takeLoan() {
      const amt = parseFloat(document.getElementById('loan-amount').value);
      if (isNaN(amt) || amt <= 0) {
        document.getElementById('loan-result').textContent = "‚ùå Invalid amount.";
        return;
      }
      if (loan.amount > 0) {
        document.getElementById('loan-result').textContent = "‚ùå Pay off your current loan first.";
        return;
      }
      loan.amount = amt;
      loan.timestamp = Date.now();
      balance += amt;
      addTransaction(`Took loan of ${amt} Kiwi`);
      updateBalance();
      updateLoanInfo();
      document.getElementById('loan-result').textContent = `‚úÖ Loan of ${amt} Kiwi taken.`;
    }

    function repayLoan() {
      if (loan.amount <= 0) {
        document.getElementById('loan-result').textContent = "‚ùå No active loan.";
        return;
      }
      const hours = Math.floor((Date.now() - loan.timestamp) / (1000 * 60 * 60));
      const interest = loan.amount * 0.1 * hours;
      const total = loan.amount + interest;
      if (balance >= total) {
        balance -= total;
        addTransaction(`Repaid loan: ${loan.amount} + ${interest.toFixed(2)} interest`);
        loan.amount = 0;
        loan.timestamp = 0;
        updateBalance();
        updateLoanInfo();
        document.getElementById('loan-result').textContent = `‚úÖ Loan repaid: ${total.toFixed(2)} Kiwi.`;
      } else {
        document.getElementById('loan-result').textContent = `‚ùå Not enough Kiwi. Need ${total.toFixed(2)}.`;
      }
    }

    function updateLoanInfo() {
      const info = document.getElementById('loan-info');
      if (loan.amount > 0) {
        const hours = Math.floor((Date.now() - loan.timestamp) / (1000 * 60 * 60));
        const interest = loan.amount * 0.1 * hours;
        info.textContent = `Active Loan: ${loan.amount} Kiwi + ${interest.toFixed(2)} interest (${hours}h).`;
      } else {
        info.textContent = "No active loan.";
      }
    }

    // -----------------------------
    // Transactions History
    // -----------------------------
    function renderTransactions() {
      const div = document.getElementById('transactions');
      div.innerHTML = "";
      transactions.forEach(t => {
        div.innerHTML += `<div class="transaction">${t}</div>`;
      });
    }

    // -----------------------------
    // Init
    // -----------------------------
    updateBalance();
    renderStonks();
    renderTransactions();
    updateLoanInfo();
    setInterval(updateStonksPrices, 30000);
    setInterval(updateLoanInfo, 60000); // Update loan info every minute
  </script>
</body>
</html>
