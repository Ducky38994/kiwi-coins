<!DOCTYPE html>
<html>
<head>
<title>Kiwi Transfer System</title>
<style>
    body { font-family: Arial; max-width: 700px; margin: auto; padding: 20px; }
    input { padding: 8px; margin: 5px 0; width: 100%; }
    button { padding: 10px; width: 100%; margin-top: 10px; cursor:pointer; }
    .box { background: #f4f4f4; padding: 15px; border-radius: 8px; margin-top: 20px; }
</style>
</head>
<body>

<h2>üçê Kiwi Transfer System</h2>

<div class="box">
    <h3>Balance: <span id="balance">0</span> Kiwi</h3>
    <input id="add" type="number" placeholder="Add Kiwi">
    <button onclick="addKiwi()">Add</button>
</div>

<div class="box">
    <h3>Generate Transfer Code</h3>
    <input id="transferAmount" type="number" placeholder="Amount (0 - 10000)">
    <button onclick="generateCode()">Generate Code</button>
    <p id="generatedCode"></p>
</div>

<div class="box">
    <h3>Redeem Transfer Code</h3>
    <input id="redeemCode" type="text" placeholder="Paste full sentence">
    <button onclick="redeem()">Redeem</button>
    <p id="redeemMsg"></p>
</div>

<script>
let balance = 0;
document.getElementById("balance").textContent = balance;

// Add Kiwi
function addKiwi() {
    let amount = parseInt(document.getElementById("add").value);
    if (!amount || amount <= 0) return;
    balance += amount;
    document.getElementById("balance").textContent = balance;
}

// Random words list
const words = [
    "faredo","luma","karin","dasko","vintel","mora","janik","sorla",
    "belto","ranix","almar","tovin","sirlo","karo","dantos","vexal"
];

function randomWord() {
    return words[Math.floor(Math.random() * words.length)];
}

// =====================
// ENCODING SYSTEM
// =====================

function generateTransferCode(amount) {
    if (amount < 0 || amount > 10000) {
        return "ERR: Amount must be between 0 and 10000";
    }

    // 6-digit padded amount
    let amtStr = amount.toString().padStart(6, "0");

    // create 40 random digits
    let code = "";
    for (let i = 0; i < 40; i++) {
        code += Math.floor(Math.random() * 10);
    }

    // positions to embed
    const pos = [3, 8, 13, 18, 23, 28];

    let arr = code.split("");
    for (let i = 0; i < 6; i++) {
        arr[pos[i]] = amtStr[i];
    }

    let numericCode = arr.join("");

    // wrap inside sentence
    return `${randomWord()} ${randomWord()} some amount to transfer d${numericCode}`;
}

// Extract 40 digits after the 'd'
function extractNumeric(sentence) {
    let i = sentence.indexOf("d");
    if (i === -1) return null;

    let onlyDigits = sentence.substring(i + 1).replace(/\D/g, "");

    if (onlyDigits.length < 40) return null;

    return onlyDigits.substring(0, 40);
}

// Decode from positions
function decodeAmount(numeric) {
    const pos = [3, 8, 13, 18, 23, 28];
    let result = "";

    for (let p of pos) {
        result += numeric[p];
    }

    return parseInt(result);
}

// =====================
// UI HANDLERS
// =====================

function generateCode() {
    let amount = parseInt(document.getElementById("transferAmount").value);

    if (isNaN(amount) || amount < 1 || amount > 10000) {
        document.getElementById("generatedCode").innerHTML = "‚ùå Invalid amount.";
        return;
    }

    if (amount > balance) {
        document.getElementById("generatedCode").innerHTML = "‚ùå Not enough balance.";
        return;
    }

    let code = generateTransferCode(amount);

    balance -= amount;
    document.getElementById("balance").textContent = balance;

    document.getElementById("generatedCode").innerHTML =
        `‚úÖ Transfer Code:<br><b>${code}</b>`;
}

function redeem() {
    let sentence = document.getElementById("redeemCode").value.trim();

    let numeric = extractNumeric(sentence);
    if (!numeric) {
        document.getElementById("redeemMsg").innerHTML = "‚ùå Invalid code format.";
        return;
    }

    let amount = decodeAmount(numeric);
    if (isNaN(amount)) {
        document.getElementById("redeemMsg").innerHTML = "‚ùå Invalid code.";
        return;
    }

    balance += amount;
    document.getElementById("balance").textContent = balance;

    document.getElementById("redeemMsg").innerHTML =
        `üéâ Redeemed <b>${amount}</b> Kiwi!`;
}
</script>

</body>
</html>
