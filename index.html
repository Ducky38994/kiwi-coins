<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Kiwi Coins</title>
<style>
body{background:#0d0d0d;color:#c8ffc8;font-family:Arial;margin:0;padding:20px}
#app{max-width:800px;margin:auto;background:#000000aa;border:2px solid #0f0;border-radius:15px;padding:20px}
h1{text-align:center;color:#00ff66;text-shadow:0 0 10px #00ff66;margin:10px 0}
.bal{text-align:center;font-size:23px;margin-bottom:20px;color:#00ff66;border:1px solid #0f0;padding:10px;border-radius:10px}
.nav{display:flex;flex-wrap:wrap;justify-content:center}
.nav button{background:#1a1a1a;border:1px solid #333;color:#ccc;padding:8px 15px;margin:5px;border-radius:6px;cursor:pointer}
.nav button.active,.nav button:hover{background:#00ff66;color:#000}
.sec{display:none;margin-top:20px;padding:15px;border:1px solid #333;border-radius:10px;background:#ffffff05}
.sec.active{display:block}
input{width:100%;padding:10px;margin:8px 0;background:#111;border:1px solid:#333;color:#0f0;border-radius:6px}
button.action{background:#00ff66;border:none;padding:10px 15px;color:#000;font-weight:bold;border-radius:6px;cursor:pointer;margin-top:5px;width:100%}
button.action:hover{opacity:.8}
.stonk{display:flex;justify-content:space-between;background:#ffffff08;padding:10px;border-radius:6px;margin-top:6px}
.tx{background:#ffffff08;padding:8px;border-radius:6px;margin:5px 0;font-size:13px}
</style>
</head>
<body>
<div id="app">
<h1>üçê Kiwi Coins</h1>

<div class="bal" id="bal">0 Kiwi</div>

<div class="nav">
<button id="b1" class="active">Mining</button>
<button id="b2">Stonks</button>
<button id="b3">Transfer</button>
<button id="b4">Loan</button>
<button id="b5">History</button>
</div>

<div id="s1" class="sec active">
<h3>‚õèÔ∏è Mining</h3>
<p>Earn 10 Kiwi per hour.</p>
<button class="action" onclick="mine()">Mine</button>
<div id="mineOut"></div>
</div>

<div id="s2" class="sec">
<h3>üìà Stonks</h3>

<h3 style="color:#0f0">‚≠ê Main Kiwi Stonk (500‚Äì1000)</h3>
<div id="mainStonkBox"></div>

<h3 style="margin-top:20px;color:#0f0">üî• Cool Stonks (20‚Äì2000)</h3>
<div id="stonkBox"></div>
</div>

<div id="s3" class="sec">
<h3>üí∏ Transfer</h3>
<input id="amt" type="number" placeholder="Amount">
<button class="action" onclick="gen()">Generate Encrypted Code</button>
<div id="codeOut"></div>

<h4>Redeem</h4>
<input id="redeem" placeholder="Enter code">
<button class="action" onclick="redeemCode()">Redeem</button>
<div id="redeemOut"></div>

<h4>QR Code</h4>
<div id="qr"></div>
</div>

<div id="s4" class="sec">
<h3>üè¶ Loan</h3>
<p>Repayment fee: 5% of borrowed amount.</p>
<input id="loanAmt" type="number" placeholder="Loan amount">
<button class="action" onclick="takeLoan()">Take Loan</button>
<button class="action" onclick="repayLoan()">Repay Loan</button>
<div id="loanOut"></div>
<div id="loanInfo"></div>
</div>

<div id="s5" class="sec">
<h3>üìú History</h3>
<div id="txBox"></div>
</div>

</div>

<script>
const $=e=>document.getElementById(e);

let bal=parseFloat(localStorage.bal||"5000");
let lastMine=parseFloat(localStorage.mine||Date.now());
let tx=JSON.parse(localStorage.tx||"[]");
let redeemed=JSON.parse(localStorage.red||"[]");
let loan=JSON.parse(localStorage.loan||"{\"amt\":0}");

let stonks=JSON.parse(localStorage.stonk||"{}");
if(Object.keys(stonks).length===0)
    stonks={wheat:{p:100,o:0},gems:{p:300,o:0},iron:{p:150,o:0},cyber:{p:500,o:0},kiwiOil:{p:250,o:0}};

// ‚≠ê MAIN STONK (500‚Äì1000)
let mainStonk = JSON.parse(localStorage.mainStonk || '{"p":700,"o":0}');

function save(){
    localStorage.bal=bal;
    localStorage.mine=lastMine;
    localStorage.tx=JSON.stringify(tx);
    localStorage.red=JSON.stringify(redeemed);
    localStorage.loan=JSON.stringify(loan);
    localStorage.stonk=JSON.stringify(stonks);
    localStorage.mainStonk = JSON.stringify(mainStonk);
}

function nav(i){
    ["b1","b2","b3","b4","b5"].forEach((b,x)=>$(b).classList.toggle("active",x==i));
    ["s1","s2","s3","s4","s5"].forEach((s,x)=>$(s).classList.toggle("active",x==i));
}

["b1","b2","b3","b4","b5"].forEach((b,i)=>$(b).onclick=()=>nav(i));

function upd(){ $("bal").innerHTML=bal.toFixed(2)+" Kiwi"; save() }
upd();

function addTx(t){ tx.unshift(new Date().toLocaleString()+" ‚Äî "+t); if(tx.length>50)tx.pop(); renderTx() }
function renderTx(){ $("txBox").innerHTML=tx.map(t=>`<div class='tx'>${t}</div>`).join("") }
renderTx();

// Mining
function mine(){
    let now=Date.now(),h=Math.floor((now-lastMine)/36e5);
    if(h<1){ $("mineOut").innerHTML="‚è≥ Need 1 hour uptime."; return }
    let r=h*10;
    bal+=r;
    lastMine=now;
    addTx("Mined "+r+" Kiwi");
    upd();
    $("mineOut").innerHTML="‚õèÔ∏è+"+r+" Kiwi";
}

// --- Smooth Stonk Movement ---
function smoothChaos(p,min,max){
    let change = (Math.random()*0.10 - 0.05); 
    let np = p*(1+change);
    if(np < min) np = min;
    if(np > max) np = max;
    return np;
}

// ‚≠ê MAIN STONK SECTION
function renderMainStonk(){
    $("mainStonkBox").innerHTML = `
        <div class='stonk'>
            <span>KiwiStonk: ${mainStonk.p.toFixed(2)} (Own ${mainStonk.o})</span>
            <div>
                <button onclick="buyMain()">Buy</button>
                <button onclick="sellMain()">Sell</button>
            </div>
        </div>`;
}

function buyMain(){
    if(bal >= mainStonk.p){
        bal -= mainStonk.p;
        mainStonk.o++;
        addTx("Bought Main Kiwi Stonk for "+mainStonk.p);
        upd(); renderMainStonk();
    }
}
function sellMain(){
    if(mainStonk.o > 0){
        mainStonk.o--;
        bal += mainStonk.p;
        addTx("Sold Main Kiwi Stonk for "+mainStonk.p);
        upd(); renderMainStonk();
    }
}

renderMainStonk();

// COOL STONKS SECTION
function renderStonks(){
    let out="";
    for(let k in stonks){
        let s=stonks[k];
        out+=`
        <div class='stonk'>
            <span>${k}: ${s.p.toFixed(2)} (Own ${s.o})</span>
            <div>
                <button onclick="buy('${k}')">Buy</button>
                <button onclick="sell('${k}')">Sell</button>
            </div>
        </div>`;
    }
    $("stonkBox").innerHTML=out;
}

function buy(k){
    let s=stonks[k];
    if(bal>=s.p){
        bal-=s.p;
        s.o++;
        addTx("Bought "+k+" for "+s.p);
        upd(); renderStonks();
    }
}

function sell(k){
    let s=stonks[k];
    if(s.o>0){
        s.o--;
        bal+=s.p;
        addTx("Sold "+k+" for "+s.p);
        upd(); renderStonks();
    }
}

renderStonks();

// Update BOTH stonk systems
setInterval(()=>{
    mainStonk.p = smoothChaos(mainStonk.p,500,1000);
    for(let k in stonks)
        stonks[k].p = smoothChaos(stonks[k].p,20,2000);

    renderMainStonk();
    renderStonks();
    save();
},4000);

// ---------------- Transfer ----------------
function enc(a){
    let b="abcdefghijklmnopqrstuvwxyz",c="",d=a.toString();
    for(let i=0;i<12;i++){
        c+=b[Math.floor(Math.random()*26)];
        if(i%Math.floor(Math.random()*2+5)==0&&d.length>0){
            c+=d[0];
            d=d.slice(1);
        }
    }
    return c+String.fromCharCode(65+(a%26));
}

function dec(c){
    let n="";
    for(let x of c) if(!isNaN(parseInt(x))) n+=x;
    let a=parseInt(n);
    return isNaN(a)||a<=0?null:a;
}

function gen(){
    let a=parseFloat($("amt").value);
    if(!a||a<=0||a>bal){ $("codeOut").innerHTML="‚ùå Invalid."; return }
    let code=enc(a);
    bal-=a;
    upd();
    addTx("Transfer "+a+" (code "+code+")");
    $("codeOut").innerHTML="‚úî Code:<br><b>"+code+"</b>";
    qr(code);
}

function redeemCode(){
    let c=$("redeem").value.trim();
    if(redeemed.includes(c)){ $("redeemOut").innerHTML="‚ö† Already used."; return }
    let a=dec(c);
    if(!a){ $("redeemOut").innerHTML="‚ùå Invalid."; return }
    redeemed.push(c);
    bal+=a;
    upd();
    addTx("Redeemed "+a);
    $("redeemOut").innerHTML="üéâ +"+a+" Kiwi";
}

function qr(t){
    $("qr").innerHTML="<img src='https://api.qrserver.com/v1/create-qr-code/?size=150x150&data="+encodeURIComponent(t)+"'>";
}

// ---------------- Loan ----------------
function takeLoan(){
    let a=parseFloat($("loanAmt").value);
    if(!a||a<=0){ $("loanOut").innerHTML="‚ùå Invalid."; return }
    if(loan.amt>0){ $("loanOut").innerHTML="‚ùå Already have loan."; return }
    loan.amt=a;
    bal+=a;
    addTx("Loan +"+a);
    upd();
    loanInfo();
}

function repayLoan(){
    if(loan.amt<=0){ $("loanOut").innerHTML="‚ùå No loan."; return }

    let fee = loan.amt * 0.05;
    let total = loan.amt + fee;

    if(bal<total){
        $("loanOut").innerHTML="‚ùå Need "+total.toFixed(2);
        return;
    }

    bal-=total;
    addTx("Repaid loan ("+total.toFixed(2)+")");
    loan.amt=0;
    upd();
    loanInfo();
}

function loanInfo(){
    $("loanInfo").innerHTML=loan.amt>0
        ? "Loan active: "+loan.amt+" + 5% fee"
        : "No loan";
}
loanInfo();
</script>

</body>
</html>
