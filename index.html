<!DOCTYPE html>
<html>
<head>
<title>Kiwi Transfer System</title>
<style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    input { padding: 8px; margin: 5px 0; width: 100%; }
    button { padding: 10px; width: 100%; margin-top: 10px; }
    .box { background: #f2f2f2; padding: 15px; border-radius: 8px; margin-top: 15px; }
</style>
</head>
<body>

<h2>Kiwi Balance System</h2>

<div class="box">
    <h3>Balance: <span id="balance">0</span> Kiwi</h3>

    <input id="add" type="number" placeholder="Add Kiwi">
    <button onclick="addKiwi()">Add</button>
</div>

<div class="box">
    <h3>Generate Transfer Code</h3>
    <input id="transferAmount" type="number" placeholder="Amount (0 - 10000)">
    <button onclick="generateCode()">Generate Code</button>
    <p id="generatedCode"></p>
</div>

<div class="box">
    <h3>Redeem Transfer Code</h3>
    <input id="redeemCode" type="text" placeholder="Enter 30-digit code">
    <button onclick="redeem()">Redeem</button>
    <p id="redeemMsg"></p>
</div>

<script>
let balance = 0;
document.getElementById("balance").textContent = balance;

// =========================
//   Add Kiwi
// =========================
function addKiwi() {
    let amount = parseInt(document.getElementById("add").value);
    if (isNaN(amount) || amount <= 0) return;

    balance += amount;
    document.getElementById("balance").textContent = balance;
}

// ============================================================
//           TRANSFER CODE GENERATION (supports 0 - 10000)
// ============================================================

function generateTransferCode(amount) {
    if (amount < 0 || amount > 10000) {
        return "ERR: Amount must be 0 - 10000";
    }

    // Pad amount to 6 digits ‚Üí supports up to 999999 safely
    let amtStr = amount.toString().padStart(6, "0");

    // Generate 30-digit random code
    let code = "";
    for (let i = 0; i < 30; i++) {
        code += Math.floor(Math.random() * 10);
    }

    // Insert amount digits into fixed positions (1-indexed)
    // Positions: 5, 10, 15, 20, 25, 30
    let positions = [4, 9, 14, 19, 24, 29]; // 0-indexed
    let newCode = code.split("");

    for (let i = 0; i < 6; i++) {
        newCode[positions[i]] = amtStr[i];
    }

    return newCode.join("");
}

function decodeTransferCode(code) {
    if (code.length !== 30) return -1;

    // Extract amount digits (6 digits)
    let positions = [4, 9, 14, 19, 24, 29];
    let digits = "";

    for (let pos of positions) {
        let d = code[pos];
        if (isNaN(parseInt(d))) return -1;
        digits += d;
    }

    return parseInt(digits); // this gives the real amount
}

// ===============================================
//            UI Actions
// ===============================================

function generateCode() {
    let amount = parseInt(document.getElementById("transferAmount").value);

    if (isNaN(amount) || amount < 0 || amount > 10000) {
        document.getElementById("generatedCode").innerHTML = "‚ùå Invalid amount.";
        return;
    }

    if (amount > balance) {
        document.getElementById("generatedCode").innerHTML = "‚ùå Not enough balance.";
        return;
    }

    let code = generateTransferCode(amount);

    balance -= amount;
    document.getElementById("balance").textContent = balance;

    document.getElementById("generatedCode").innerHTML =
        `‚úÖ Transfer Code: <b>${code}</b>`;
}

function redeem() {
    let code = document.getElementById("redeemCode").value;

    let amount = decodeTransferCode(code);
    if (amount < 0) {
        document.getElementById("redeemMsg").innerHTML = "‚ùå Invalid code.";
        return;
    }

    balance += amount;
    document.getElementById("balance").textContent = balance;

    document.getElementById("redeemMsg").innerHTML =
        `üéâ Successfully redeemed <b>${amount} Kiwi</b>!`;
}
</script>

</body>
</html>
