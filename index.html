<!DOCTYPE html>
<html>
<head>
<title>Kiwi Transfer System</title>
<style>
    body { font-family: Arial; max-width: 600px; margin: auto; padding: 20px; }
    input { padding: 8px; margin: 5px 0; width: 100%; }
    button { padding: 10px; width: 100%; margin-top: 10px; }
    .box { background: #f2f2f2; padding: 15px; border-radius: 8px; margin-top: 15px; }
</style>
</head>
<body>

<h2>Kiwi Balance System</h2>

<div class="box">
    <h3>Balance: <span id="balance">0</span> Kiwi</h3>

    <input id="add" type="number" placeholder="Add Kiwi">
    <button onclick="addKiwi()">Add</button>
</div>

<div class="box">
    <h3>Generate Transfer Code</h3>
    <input id="transferAmount" type="number" placeholder="Amount (0 - 10000)">
    <button onclick="generateCode()">Generate Code</button>
    <p id="generatedCode"></p>
</div>

<div class="box">
    <h3>Redeem Transfer Code</h3>
    <input id="redeemCode" type="text" placeholder="Paste full sentence code">
    <button onclick="redeem()">Redeem</button>
    <p id="redeemMsg"></p>
</div>

<script>
let balance = 0;
document.getElementById("balance").textContent = balance;

// =========================
//   Add Kiwi
// =========================
function addKiwi() {
    let amount = parseInt(document.getElementById("add").value);
    if (isNaN(amount) || amount <= 0) return;

    balance += amount;
    document.getElementById("balance").textContent = balance;
}

// =========================
//  Random Word Generator
// =========================
const words = [
    "faredo","luma","karin","dasko","vintel","mora","janik","sorla",
    "belto","ranix","almar","tovin","sirlo","karo","dantos","vexal"
];

function randomWord() {
    return words[Math.floor(Math.random() * words.length)];
}

// ============================================================
//         TRANSFER CODE GENERATION (0‚Äì10000)
//         Hidden digits inside a 30-digit block
// ============================================================

function generateTransferCode(amount) {
    if (amount < 0 || amount > 10000) {
        return "ERR: Amount must be 0 - 10000";
    }

    // pad amount ‚Üí 6 digits
    let amtStr = amount.toString().padStart(6, "0");

    // random 30-digit number
    let code = "";
    for (let i = 0; i < 30; i++) {
        code += Math.floor(Math.random() * 10);
    }

    // insert amount digits at fixed positions
    let positions = [4, 9, 14, 19, 24, 29];
    let arr = code.split("");

    for (let i = 0; i < 6; i++) {
        arr[positions[i]] = amtStr[i];
    }

    let encoded = arr.join("");

    // FINAL SENTENCE FORMAT
    return `${randomWord()} ${randomWord()} some amount to transfer d${encoded}`;
}

function extractNumericCode(sentence) {
    let idx = sentence.indexOf("d");
    if (idx === -1) return null;

    let possible = sentence.substring(idx + 1).replace(/\D/g, "");

    if (possible.length < 30) return null;

    return possible.substring(0, 30);
}

function decodeTransferCode(code) {
    if (!code || code.length !== 30) return -1;

    let positions = [4, 9, 14, 19, 24, 29];
    let digits = "";

    for (let pos of positions) {
        let d = code[pos];
        if (isNaN(parseInt(d))) return -1;
        digits += d;
    }

    return parseInt(digits);
}

// ===============================================
//                  UI
// ===============================================

function generateCode() {
    let amount = parseInt(document.getElementById("transferAmount").value);

    if (isNaN(amount) || amount < 0 || amount > 10000) {
        document.getElementById("generatedCode").innerHTML = "‚ùå Invalid amount.";
        return;
    }

    if (amount > balance) {
        document.getElementById("generatedCode").innerHTML = "‚ùå Not enough balance.";
        return;
    }

    let code = generateTransferCode(amount);

    balance -= amount;
    document.getElementById("balance").textContent = balance;

    document.getElementById("generatedCode").innerHTML =
        `‚úÖ Transfer Code:<br><b>${code}</b>`;
}

function redeem() {
    let sentence = document.getElementById("redeemCode").value;

    let numeric = extractNumericCode(sentence);

    if (!numeric) {
        document.getElementById("redeemMsg").innerHTML = "‚ùå Invalid format.";
        return;
    }

    let amount = decodeTransferCode(numeric);

    if (amount < 0) {
        document.getElementById("redeemMsg").innerHTML = "‚ùå Invalid code.";
        return;
    }

    balance += amount;
    document.getElementById("balance").textContent = balance;

    document.getElementById("redeemMsg").innerHTML =
        `üéâ Successfully redeemed <b>${amount} Kiwi</b>!`;
}
</script>

</body>
</html>
